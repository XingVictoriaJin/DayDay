# last day of July
## web step-on
  @Valid
  AOP
  Exception(not only try-catch)
  Unit test(postman, or usecase incode)
  
**git clone url**
**git checkout -b web-2 web-2**

limit age >= 18
how? 
WAS:
Girl girlAdd(@RequestParam("age") Integer age){}
What about we have many properties? 
IS:
public Girl girlAdd(Girl girl){
  girl.setXXX();
  girl.setXXX(); 
  return girlRespoistory.save(girl);
}

go to Girl class, add annotation
@Min(value=18, message="under 18 is not allowed")
private Integer age;

then go to girlAdd method
public Girl girlAdd(@Valid Girl girl, BindingResult bindingResult){
  //bindingResult shows validation result, if errros, print message out
  if(biningResult.hasErrors){
     System.out.println(bindingResult.getFieldError().getDefaultMessage());
     return null;
  }
}

AOP: deal with log
编程范式，程序设计思想

add dependency: spirng-boot-starter-aop
add aspect package: build java class 
```
 @Aspect
 @Component
 public class HttpAspect{
    // logic code
    @Before("execution(public * com.imooc.controller.GirlController.girlList(..))")
    public void log(){
        System.out.println(1111111);
    }
 }
```
if block all, then ..GirlController.*

before annoation executes before methods
```
@After("execution(public * com.imooc.controller.GirlController.*(..))")
public void doAfter(){
  System.out.println(222222);
}
```

duplicate parts discovered. so how we can improve? 
change to:
```
private final static Logger logger = LoggerFactory.getLogger(HttpAspect.class); //inside parameter needs to be updated per individual class

@Pointcut("execution(public * com.imooc.controller.GirlController.*(..))")
public void log(){}

@Before("log()")
public void doBefore(){
  logger.info("111111111");
  logger.error();
}

@After("log()")
public void doAfter(){
  logger.info("2222222");
}
```
```
  @Before("log()")
  public void doBefore(){
    ServletRequestAttributes attributes = RequestContextHolder.getRequestAttributes();
    HttpServletRequest request = attributes.getRequest();
    //url
    logger.info("url={}", request.getRequestURL());
    
    //method
    logger.info("method={}", request.geMethod());
    //ip
    logger.info("ip={}", request.getRemoteAddr());
    //class method
    logger.info("class_method={}", joinPoint.getSignatrure().getDeclaringTypeName()+"."+joinPoint.getSignature().getName());
    //parameter
    logger.info("args={}", joinPoint.getArgs());
  }
  
  
 how to get return result
 @AfterReturning(returning ="object" pointcut ="log()")
 public void do AfterReturning(Object object){
      logger.info("response={}", object);
 }
 
 //if you want to print specific content, add toString() method to Girl class
 
```
Exception process





